<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ChatHub - Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
    .chat-container { flex: 1; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; }
    .message { margin: 10px 0; display: flex; align-items: flex-end; animation: slide 0.3s ease; }
    .message .avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 8px; }
    .message .content { background: #dcf8c6; padding: 8px 12px; border-radius: 10px; max-width: 60%; position: relative; }
    .message .content::after { content: attr(data-time); font-size: 10px; color: gray; position: absolute; bottom: -15px; right: 5px; }
    .input-area { display: flex; padding: 10px; background: white; }
    .input-area input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
    .input-area button { margin-left: 10px; padding: 0 15px; border: none; background: #007bff; color: white; border-radius: 50%; font-size: 20px; cursor: pointer; }
    @keyframes slide { from { transform: translateX(-30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCe6ZDW_1dUn9WCnrls_9Y5ookztnf_0Zs",
      authDomain: "chathub-25042025.firebaseapp.com",
      databaseURL: "https://chathub-25042025-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "chathub-25042025",
      storageBucket: "chathub-25042025.appspot.com",
      messagingSenderId: "616104747114",
      appId: "1:616104747114:web:6f981f3cdc93199126aa13",
      measurementId: "G-GFPB602T33"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const chatContainer = document.getElementById('chat');
    const input = document.getElementById('messageInput');

    let currentUser = null;

    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        loadMessages();
      } else {
        window.location.href = 'index.html';
      }
    });

    function loadMessages() {
      const messagesRef = ref(db, 'messages');
      onChildAdded(messagesRef, snapshot => {
        const msg = snapshot.val();
        addMessage(msg);
      });
    }

    function addMessage(msg) {
      const div = document.createElement('div');
      div.className = 'message';
      div.innerHTML = `
        <img src="${msg.avatar}" class="avatar" />
        <div class="content" data-time="${msg.time}">
          <strong>${msg.name}:</strong> ${msg.text}
        </div>
      `;
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    window.sendMessage = function () {
      const text = input.value.trim();
      if (text !== '') {
        const messagesRef = ref(db, 'messages');
        push(messagesRef, {
          name: currentUser.displayName,
          avatar: currentUser.photoURL || 'https://via.placeholder.com/40',
          text: text,
          time: new Date().toLocaleTimeString()
        });
        input.value = '';
      }
    };

    window.logout = function () {
      signOut(auth);
    };

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
  </script>
</head>
<body>
  <div id="chat" class="chat-container"></div>
  <div class="input-area">
    <input id="messageInput" type="text" placeholder="Nhập tin nhắn..." />
    <button onclick="sendMessage()">➤</button>
  </div>
</body>
</html>
